<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="admin/layout :: layout(~{::body})">
<body>
  <section class="content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="card card-primary">
            <div class="card-body p-0">
              <div id="calendar-full"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Modal para quantidade mínima de dias -->
  <div class="modal fade" id="minDaysModal" tabindex="-1" role="dialog" aria-labelledby="minDaysModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <form id="min-days-form">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Quantidade Mínima de Dias</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="min-days">Informe a quantidade mínima de dias para reservas</label>
              <input type="number" min="1" class="form-control" id="min-days" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Confirmar</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script th:src="@{/plugins/jquery/jquery.min.js}"></script>
  <script th:src="@{/plugins/moment/moment.min.js}"></script>
  <script th:src="@{/plugins/moment/pt-br.js}"></script>
  <script th:src="@{/plugins/fullcalendar/main.js}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      moment.locale('pt-br');

      let selectedRange = null;
      const calendarEl = document.getElementById('calendar-full');

      const calendar = new FullCalendar.Calendar(calendarEl, {
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        themeSystem: 'bootstrap',
        selectable: true,
        select: function (info) {
          selectedRange = info;
          $('#min-days').val('');
          $('#minDaysModal').modal('show');
        }
      });

      $('#min-days-form').on('submit', function (e) {
        e.preventDefault();
        const minDays = parseInt($('#min-days').val(), 10);
        if (isNaN(minDays) || !selectedRange) return;

        const startDate = moment(selectedRange.start);
        const endDate = moment(selectedRange.end);
        const totalDays = endDate.diff(startDate, 'days');

        if (totalDays <= 0) {
          alert('Selecione um período válido.');
          return;
        }

        calendar.addEvent({
          title: `Mínimo ${minDays} dia(s)`,
          start: startDate.format('YYYY-MM-DD'),
          end: endDate.format('YYYY-MM-DD'),
          allDay: true
        });

        alert(`Restrição criada: \nPeríodo: ${startDate.format('LL')} a ${endDate.subtract(1, 'days').format('LL')}\nMínimo de ${minDays} dia(s) por reserva.`);

        $('#minDaysModal').modal('hide');
        selectedRange = null;
      });

      calendar.render();
    });
  </script>
</body>
</html>