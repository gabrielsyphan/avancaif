<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="admin/layout :: layout(~{::body})">
<body>
  <section class="content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="card card-primary">
            <div class="card-body p-0">
              <div id="calendar-full"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Modal para valor da diária -->
  <div class="modal fade" id="priceModal" tabindex="-1" role="dialog" aria-labelledby="priceModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <form id="price-form">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Valor da Diária</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="daily-price">Informe o valor da diária (R$)</label>
              <input type="number" step="0.01" min="0" class="form-control" id="daily-price" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Confirmar</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script th:src="@{/plugins/jquery/jquery.min.js}"></script>
  <script th:src="@{/plugins/moment/moment.min.js}"></script>
  <script th:src="@{/plugins/moment/pt-br.js}"></script>
  <script th:src="@{/plugins/fullcalendar/main.js}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      moment.locale('pt-br');

      let selectedRange = null;
      const calendarEl = document.getElementById('calendar-full');

      const calendar = new FullCalendar.Calendar(calendarEl, {
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        themeSystem: 'bootstrap',
        selectable: true,
        select: function (info) {
          selectedRange = info;
          $('#daily-price').val('');
          $('#priceModal').modal('show');
        }
      });

      $('#price-form').on('submit', function (e) {
        e.preventDefault();
        const price = parseFloat($('#daily-price').val());
        if (isNaN(price) || !selectedRange) return;

        let currentDate = moment(selectedRange.start);
        const endDate = moment(selectedRange.end);

        let count = 0;
        while (currentDate.isBefore(endDate)) {
          calendar.addEvent({
            title: `R$ ${price.toFixed(2)}`,
            start: currentDate.format('YYYY-MM-DD'),
            allDay: true
          });
          currentDate.add(1, 'days');
          count++;
        }

        alert(`Evento criado para ${count} dia(s) com valor de R$ ${price.toFixed(2)} por dia.`);

        $('#priceModal').modal('hide');
        selectedRange = null;
      });

      calendar.render();
    });
  </script>
</body>
</html>